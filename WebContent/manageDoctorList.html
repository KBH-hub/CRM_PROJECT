<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>의사 명단</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-body-tertiary">
<div class="container-fluid">
  <div class="row g-0">

    <div id="sidebar-slot" class="col-2 p-0"></div>
    <main class="col-10 p-4">
      <div class="container bg-white border rounded shadow-sm p-4">
        <h4 class="text-center fw-bold mb-4 text-primary">의사 명단</h4>

        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle text-center">
            <thead class="table-light">
              <tr>
                <th style="width: 20%">의사코드</th>
                <th style="width: 30%">이름</th>
                <th style="width: 50%">진료과</th>
              </tr>
            </thead>
   		    <tbody id="doctorTableBody"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="sidebar.js"></script>

<script>
function loadSidebar(activeKey) {
	  $.ajax({
	    url: "./sidebar.html",
	    dataType: "html",
	    success: function (html) {
	      $("#sidebar-slot").html(html);
	      var $links = $("#sidebar-slot").find("#sidebar-nav .nav-link");
	      $links.removeClass("active bg-primary text-white").addClass("text-dark");
	      var $current = $links.filter("[data-route='" + activeKey + "']");
	      $current.addClass("active bg-primary text-white").removeClass("text-dark");
	      loadSidebarInfo();
	    }
	  });
	}
loadSidebar("manageDoctorSchedule");

function showAlert(message, onClose) {
  $("#alertMessage").text(message);
  var modal = new bootstrap.Modal(document.getElementById("alertModal"));
  $("#alertModal").on("hidden.bs.modal", function handler() {
    if (typeof onClose === "function") onClose();
    $("#alertModal").off("hidden.bs.modal", handler);
  });
  modal.show();
}

function renderTable(list) {
	  var $tbody = $("#doctorTableBody");
	  $tbody.empty();
	  if (!list || list.length === 0) {
	    $tbody.html("<tr><td colspan='3' class='text-center text-muted py-3'>조회된 의사 정보가 없습니다.</td></tr>");
	    return;
	  }
	  $.each(list, function(i, p) {
	    var tr = `
	      <tr>
	        <td>${p.doctorCode || '-'}</td>
	        <td>${p.employeeName || '-'}</td>
	        <td>${p.department || '-'}</td>
	      </tr>`;
	    $tbody.append(tr);
	  });
}
	
function loadDoctorList() {
	  $.ajax({
	    url: "controller",
	    type: "GET",
	    data: { cmd: "getDoctorListAction" },
	    dataType: "json",
	    success: function(data) {
	      renderTable(data || []);
	    },
	    error: function() {
	      showAlert("의사 목록을 불러오는 중 오류가 발생했습니다.");
	    }
	  });
	}

loadDoctorList();
</script>
</body>
</html>
