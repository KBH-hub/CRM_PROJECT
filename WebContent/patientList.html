<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>í™˜ì ëª©ë¡</title>

<!-- âœ… Bootstrap 5.3.0 -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<style>
#pager .page-item.active .page-link {
	background: #212529;
	color: #fff;
	border-color: #212529;
	border-radius: .6rem;
}

#pager .page-item.disabled .page-link {
	color: #bbb;
	pointer-events: none;
	background: transparent;
	border-color: transparent;
}

#pager .page-link {
	border: none;
	background: transparent;
	color: #4a4a4a;
}
</style>
</head>
<body class="bg-body-tertiary">
<div class="container-fluid">
  <div class="row">

    <!-- ì—¬ê¸°ì„œ ì‚¬ì´ë“œë°”ë¥¼ ì£¼ì… -->
    <div id="sidebar-slot" class="col-2 p-0"></div>

    <!-- ë©”ì¸ -->
    <main class="col-10 p-4">
      <h2 class="mb-3 border-bottom pb-2">í™˜ì ê´€ë¦¬</h2>
       <div class="card"><div class="card-body">
			<!-- ğŸ” ê²€ìƒ‰ ì˜ì—­ -->
			<div class="mb-4">
				<div class="d-flex flex-wrap gap-2 align-items-center">
					<input type="date" class="form-control w-auto"> <input
						type="date" class="form-control w-auto"> <select
						class="form-select w-auto">
						<option selected disabled hidden>ë‹´ë‹¹ì˜ì‚¬</option>
						<option>ì „ì²´</option>
						<option>ê¹€ì˜ì‚¬</option>
						<option>ì‚¬ê³µê¸¸ë™</option>
					</select> <select class="form-select w-auto">
						<option>ìƒë…„ì›”ì¼</option>
						<option>ì´ë¦„</option>
					</select> <input type="text" class="form-control w-auto"
						placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
					<button class="btn btn-primary">ê²€ìƒ‰</button>
				</div>
			</div>

			<!-- ğŸ§¾ í™˜ì ëª©ë¡ í…Œì´ë¸” -->
			<div class="table-responsive">
				<table class="table table-bordered align-middle text-center">
					<thead class="table-light">
						<tr>
							<th><input type="checkbox" id="selectAll"></th>
							<th>í™˜ìë“±ë¡ë²ˆí˜¸</th>
							<th>ì´ë¦„</th>
							<th>ì „í™”ë²ˆí˜¸</th>
							<th>ìµœê·¼ë‚´ì›ì¼</th>
							<th>ë‹´ë‹¹ì˜ì‚¬</th>
							<th>ì§„ë£Œê³¼</th>
							<th>ìƒíƒœ</th>
							<th>ì§„ë‹¨ëª…</th>
							<th>ìƒì„¸</th>
						</tr>
					</thead>
					<tbody id="patientTableBody"></tbody>
				</table>
			</div>

			<!-- âš™ ë²„íŠ¼ ì˜ì—­ -->
			<div class="my-3 d-flex justify-content-center gap-2">
				<button class="btn btn-primary" id="add-btn">ê³ ê° ë“±ë¡</button>
				<button class="btn btn-primary" id="sendSmsBtn">ì„ íƒ ë©”ì‹œì§€ ë³´ë‚´ê¸°</button>
				<button class="btn btn-danger">ì„ íƒ ì‚­ì œ</button>
			</div>

			<!-- âœ… í˜ì´ì§€ ì´ë™ ë²„íŠ¼ -->
			<nav aria-label="í˜ì´ì§€ ì´ë™" class="d-flex justify-content-center my-3">
				<ul id="pager"
					class="pagination pagination-sm align-items-center gap-2">
					<!-- ì²˜ìŒ / ì´ì „ -->
					<li class="page-item"><button class="page-link"
							data-action="first" aria-label="ì²˜ìŒ">Â«</button></li>
					<li class="page-item"><button class="page-link"
							data-action="prev" aria-label="ì´ì „">â€¹</button></li>

					<!-- ìˆ«ìë“¤ -->
					<li class="page-item"><button class="page-link" data-page="1">1</button></li>
					<li class="page-item"><button class="page-link" data-page="2">2</button></li>
					<li class="page-item"><button class="page-link" data-page="3">3</button></li>
					<li class="page-item"><button class="page-link" data-page="4">4</button></li>
					<li class="page-item"><button class="page-link" data-page="5">5</button></li>
					<li class="page-item"><button class="page-link" data-page="6">6</button></li>

					<!-- ë‹¤ìŒ / ë§ˆì§€ë§‰ -->
					<li class="page-item"><button class="page-link"
							data-action="next" aria-label="ë‹¤ìŒ">â€º</button></li>
					<li class="page-item"><button class="page-link"
							data-action="last" aria-label="ë§ˆì§€ë§‰">Â»</button></li>
				</ul>
			</nav></div></div>
			</main>
		</div>
	</div>
	<script>
  // âœ… sidebar ë¡œë“œ
  async function loadSidebar(activeKey) {
    const slot = document.getElementById('sidebar-slot');
    const resp = await fetch('./sidebar.html');
    slot.innerHTML = await resp.text();
    const current = slot.querySelector(`[data-route="${activeKey}"]`);
    if (current) {
      slot.querySelectorAll('#sidebar-nav .nav-link').forEach(a => {
        a.classList.remove('active','bg-primary','text-white');
        a.classList.add('text-dark');
      });
      current.classList.add('active','bg-primary','text-white');
      current.classList.remove('text-dark');
    }
  }
  loadSidebar('patientList');


  // âœ… ì „ì²´ ì„ íƒ
  document.addEventListener("DOMContentLoaded", () => {
    const selectAll = document.getElementById("selectAll");
    selectAll.addEventListener("change", () => {
      document.querySelectorAll(".row-check").forEach(chk => chk.checked = selectAll.checked);
    });
  });

  document.getElementById("sendSmsBtn").addEventListener("click", () => {
    window.location.href = "smsService.html?tab=common";
  });
  document.getElementById("add-btn").addEventListener("click", () => {
    window.location.href = "patientAdd.html";
  });

  // âœ… ìƒì„¸ë³´ê¸°
  document.addEventListener("click", e => {
    const btn = e.target.closest(".detail-btn");
    if (!btn) return;
    window.location.href = "patientInfo.html";
  });

  // âœ… í™˜ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° + í˜ì´ì§€ë„¤ì´ì…˜ ì²˜ë¦¬
  const pageSize = 10;
  let currentPage = 1;
  let totalPages = 1;

  async function loadPatientList(page = 1) {
    try {
      const resp = await fetch(`controller?cmd=getPatientListAction&page=${page}&pageSize=${pageSize}`);
      if (!resp.ok) throw new Error("ì„œë²„ ì˜¤ë¥˜");
      const data = await resp.json();
      const list = data.list;
      const totalCount = data.totalCount || 0;
      totalPages = Math.ceil(totalCount / pageSize);
      currentPage = page;
      renderTable(list);
      renderPager();
    } catch (err) {
      console.error(err);
      alert("í™˜ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  }

  function renderTable(list) {
    const tbody = document.getElementById("patientTableBody");
    tbody.innerHTML = "";
    if (!list || list.length === 0) {
      tbody.innerHTML = `<tr><td colspan="10" class="text-center text-muted py-3">ì¡°íšŒëœ í™˜ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      return;
    }
    list.forEach(p => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input type="checkbox" class="row-check"></td>
        <td>${p.patientNo || '-'}</td>
        <td>${p.patientName || '-'}</td>
        <td>${p.phone || '-'}</td>
        <td>${p.medicalDate || '-'}</td>
        <td>${p.employeeName || '-'}</td>
        <td>${p.department || '-'}</td>
        <td>${p.status || '-'}</td>
        <td>${p.diagnosis || '-'}</td>
        <td>
          <button class="btn btn-link p-0 detail-btn">
            <img src="detail.png" alt="ìƒì„¸ë³´ê¸°" width="24" height="24">
          </button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  // âœ… í˜ì´ì§€ ë²„íŠ¼ ë Œë”ë§
  function renderPager() {
    const pager = document.getElementById('pager');
    pager.innerHTML = "";

    const addPageBtn = (label, action, disabled=false, active=false) => {
      const li = document.createElement("li");
      li.className = `page-item ${disabled ? 'disabled' : ''} ${active ? 'active' : ''}`;
      li.innerHTML = `<button class="page-link" ${disabled?'tabindex="-1"':''} data-action="${action}">${label}</button>`;
      pager.appendChild(li);
    };

    addPageBtn("Â«","first", currentPage===1);
    addPageBtn("â€¹","prev", currentPage===1);

    for (let i = 1; i <= totalPages; i++) {
      const li = document.createElement("li");
      li.className = `page-item ${i===currentPage?'active':''}`;
      li.innerHTML = `<button class="page-link" data-page="${i}">${i}</button>`;
      pager.appendChild(li);
    }

    addPageBtn("â€º","next", currentPage===totalPages);
    addPageBtn("Â»","last", currentPage===totalPages);

    pager.querySelectorAll(".page-link").forEach(btn => {
      btn.addEventListener("click", () => {
        const p = btn.dataset.page;
        const action = btn.dataset.action;
        if (p) loadPatientList(Number(p));
        else if (action==="first") loadPatientList(1);
        else if (action==="prev" && currentPage>1) loadPatientList(currentPage-1);
        else if (action==="next" && currentPage<totalPages) loadPatientList(currentPage+1);
        else if (action==="last") loadPatientList(totalPages);
      });
    });
  }

  // âœ… ì²« í˜ì´ì§€ ë¡œë“œ
  document.addEventListener("DOMContentLoaded", () => loadPatientList(1));
</script>

	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>